# Promptathon Showcase

A decentralized app showcase and gallery built on the Internet Computer with AI-powered metadata extraction, screenshot capture, and search.

## Overview

Promptathon Showcase allows users to browse and search Internet Computer applications in a gallery format with rich metadata including titles, descriptions, and screenshots. A build-time indexer crawls submitted app URLs, extracts and enriches metadata using AI, captures screenshots, and bundles everything into the canister.

**Features:**
- Full-text search on app titles and descriptions
- AI-powered metadata enrichment (OpenAI or Anthropic)
- Dual-resolution screenshots (1500x844 and 300x169) bundled in the canister
- React frontend with TanStack Router
- SSR with route-specific SEO meta tags
- SQLite backend with certified HTTP responses

## Quick Start

### Prerequisites

- `dfx` CLI installed
- Node.js / pnpm
- OpenAI or Anthropic API key

### 1. Start Local Replica

```bash
dfx stop
dfx start --clean --background
```

### 2. Run the Indexer

The indexer crawls app URLs, generates AI metadata, and captures screenshots:

```bash
cd indexer
pnpm install
pnpm exec playwright install chromium
cp .env.example .env
# Edit .env with your AI API key

pnpm dev
```

This produces:
- `src/server/src/seeds/seed_apps.sql` - SQL seed data
- `indexer/images/` - Screenshot JPEGs

Results are cached in `submissions.csv` and `indexer/images/` so re-runs skip already-processed apps. See [indexer/README.md](indexer/README.md) for details.

### 3. Deploy

```bash
dfx deploy server
```

The deploy process (defined in `dfx.json`) runs these steps:
1. `pnpm run build` - Vite builds the frontend to `dist/`
2. `cp -r indexer/images dist/images` - Copies screenshots into the build output
3. `cargo build` - Compiles the Rust canister, embedding `dist/` (including images) via `include_dir!`
4. `wasi2ic` - Converts the WASM for IC deployment

### 4. Access the App

```
http://<canister-id>.localhost:4943/
```

### Development

Run the Vite dev server for frontend development with hot reload:

```bash
pnpm run dev
```

Images are proxied to the local canister automatically.

## Architecture

**Frontend (React + Vite):**
- TanStack Router with file-based routing
- Tailwind CSS
- IC agent for canister queries

**Backend (Rust Canister):**
- SQLite database with full-text search
- Certified HTTP asset serving
- SSR with minijinja templates for SEO meta tags
- Static assets (JS, CSS, images) embedded at compile time

**Indexer (Node.js):**
- Playwright for web scraping and screenshots
- OpenAI/Anthropic for metadata enrichment
- Incremental: caches results in CSV and on disk

## Project Structure

```
.
├── src/
│   ├── components/            # React components
│   ├── hooks/                 # React hooks (useServer)
│   ├── lib/                   # Constants and utilities
│   ├── routes/                # TanStack Router file-based routes
│   └── server/                # Rust canister
│       ├── src/
│       │   ├── lib.rs         # Canister init, HTTP handlers, Candid API
│       │   ├── page/          # Database models & queries
│       │   ├── routes/        # SSR route handlers
│       │   └── seeds/         # SQL seed files (generated by indexer)
│       └── server.did         # Candid interface
├── indexer/                   # Node.js build-time indexer
│   ├── src/
│   │   ├── indexer.ts         # Processing pipeline
│   │   ├── extractor.ts       # Playwright screenshots
│   │   ├── ai.ts              # OpenAI/Anthropic enrichment
│   │   └── csv.ts             # CSV read/write
│   ├── run.ts                 # CLI entry point
│   ├── submissions.csv        # Input data + cached AI results
│   └── images/                # Cached screenshots (gitignored)
├── router_library/            # Custom IC HTTP routing library
├── dfx.json                   # IC deployment config
└── vite.config.ts             # Vite config with image proxy
```

## Environment Variables

### Indexer (`indexer/.env`)

```bash
# AI Provider (choose one)
# OPENAI_API_KEY=sk-...
ANTHROPIC_API_KEY=sk-ant-...

# Limit submissions to process (useful during development)
LIMIT=5

# Network: "local" for local dfx replica, "ic" for mainnet
# Canister ID is auto-resolved from canister_ids.json
NETWORK=local
```

## API Reference

### Candid Interface

```candid
service : {
    http_request : (HttpRequest) -> (HttpResponse) query;
    http_request_update : (HttpRequest) -> (HttpResponse);
    list_apps : () -> (vec App) query;
    get_app : (int64) -> (GetAppResult) query;
    search : (text) -> (SearchResult) query;
};
```

### Types

```candid
type App = record {
    id : int64;
    url : text;
    canister_id : opt text;
    title : text;
    description : text;
    image_id : opt text;
    author_name : opt text;
    app_name : opt text;
    social_post_url : opt text;
    created_at : int64;
    updated_at : int64;
};
```

## License

MIT
