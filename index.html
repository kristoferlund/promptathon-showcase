<!doctype html>
<html lang="en" class="bg-background">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{title}}</title>
    <meta name="description" content="{{description}}" />
    <meta property="og:title" content="{{title}}" />
    <meta property="og:description" content="{{description}}" />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="{{title}}" />
    <meta name="twitter:description" content="{{description}}" />
    <link rel="stylesheet" href="/assets/style.css">
  </head>
  <body class="text-foreground">
    <div class="min-h-screen flex flex-col items-center">

      <!-- Header -->
      <div class="w-full max-w-[640px] px-4 pt-16 flex flex-col items-center">
        <h1 class="font-semibold text-foreground text-4xl tracking-tight">
          Promptathon Showcase
        </h1>
        <p class="text-muted-foreground text-sm mt-4">{{app_count}} apps built with prompts</p>
      </div>

      <!-- Search Form -->
      <div class="w-full max-w-[640px] px-4 mt-8">
        <form method="GET" action="/">
          <div class="relative flex-1">
            <div class="absolute left-4 top-1/2 -translate-y-1/2 text-muted-foreground">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
            </div>
            <input
              type="text"
              name="q"
              value="{{query}}"
              placeholder="Search apps..."
              autocomplete="off"
              class="w-full h-12 text-[15px] pl-12 pr-4 rounded-full border border-border bg-card text-foreground placeholder:text-muted-foreground focus:bg-secondary focus:border-primary transition-all focus:outline-none"
              autofocus
            />
          </div>
        </form>
      </div>

      {% if query %}
      <!-- Search Results -->
      <div class="w-full max-w-[640px] px-4 mt-10 pb-16">
        {% if has_search_results %}
        <div class="text-xs text-muted-foreground mb-6 font-medium">
          {{search_result_count}} result{% if search_result_count != 1 %}s{% endif %} for "{{query}}"
        </div>
        <div class="flex flex-col space-y-5">
          {% for app in search_results %}
          <a href="/app/{{app.id}}?ref={{query}}" class="block group">
            {% if app.image_id %}
            <div class="flex gap-4 items-center">
              <div class="flex-shrink-0 w-52 h-28 rounded overflow-hidden bg-card">
                <img src="{{r2_public_url}}/{{app.image_id}}_200.jpg" alt="{{app.title}}" class="w-full h-full object-cover" loading="lazy" />
              </div>
              <div class="flex-1 min-w-0">
                {% if app.app_name %}
                <div class="text-xs text-muted-foreground mb-1 font-medium">{{app.app_name}}{% if app.author_name %} by {{app.author_name}}{% endif %}</div>
                {% endif %}
                <div class="text-lg font-medium text-primary group-hover:text-primary/80 mb-1 transition-colors leading-snug">
                  {{app.title}}
                </div>
                <div class="text-muted-foreground text-sm leading-relaxed line-clamp-2">
                  {{app.description}}
                </div>
              </div>
            </div>
            {% else %}
            <div>
              {% if app.app_name %}
              <div class="text-xs text-muted-foreground mb-1 font-medium">{{app.app_name}}{% if app.author_name %} by {{app.author_name}}{% endif %}</div>
              {% endif %}
              <div class="text-lg font-medium text-primary group-hover:text-primary/80 mb-1 transition-colors leading-snug">
                {{app.title}}
              </div>
              <div class="text-muted-foreground text-sm leading-relaxed line-clamp-2">
                {{app.description}}
              </div>
            </div>
            {% endif %}
          </a>
          {% endfor %}
        </div>
        {% else %}
        <div class="text-center text-muted-foreground text-sm">
          No results found for "{{query}}"
        </div>
        {% endif %}
      </div>

      {% else %}
      <!-- App Gallery Grid (only when not searching) -->
      <div class="w-full px-6 mt-12 pb-16">
        <div style="display: grid; grid-template-columns: repeat(auto-fill, 200px); gap: 16px; justify-content: center;">
          {% for app in apps %}
          <a href="/app/{{app.id}}" class="group block rounded-lg overflow-hidden transition-all" style="width: 200px;">
            {% if app.image_id %}
            <div class="overflow-hidden rounded-lg bg-secondary" style="width: 200px; height: 112px;">
              <img
                src="{{r2_public_url}}/{{app.image_id}}_200.jpg"
                alt="{{app.title}}"
                class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                loading="lazy"
              />
            </div>
            {% else %}
            <div class="rounded-lg bg-secondary flex items-center justify-center" style="width: 200px; height: 112px;">
              <span class="text-muted-foreground" style="font-size: 10px;">No preview</span>
            </div>
            {% endif %}
            <div style="padding: 6px 2px;">
              <div class="font-medium text-foreground leading-tight line-clamp-1" style="font-size: 12px;">
                {% if app.app_name %}{{app.app_name}}{% else %}{{app.title}}{% endif %}
              </div>
              {% if app.author_name %}
              <div class="text-muted-foreground/50 leading-tight" style="font-size: 10px; margin-top: 2px;">
                {{app.author_name}}
              </div>
              {% endif %}
            </div>
          </a>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <!-- Footer -->
      <footer class="pb-8 text-center text-muted-foreground text-xs">
        Running on the <a href="https://internetcomputer.org" class="underline text-primary" target="_blank">Internet Computer</a>
      </footer>
    </div>
  </body>
</html>
